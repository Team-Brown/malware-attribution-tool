import os
import gensim
import pprint
from gensim import corpora
from collections import defaultdict

# change directory to where the all samples are stored
os.chdir('samples/equationGroup')

# objdump -d /path/to/file > outputfile.txt output -- need to automate
# load binaries in one folder
# perform objdump on each one in one instance of running the script
objdump = open('triple_fantasy.txt', 'r')

# file to write the extracted instructions to
instructions = open("triple_fantasy_instructions.txt", "w+")

def parseInstructions(o,i):
    lines = o.readlines()

    for line in lines:
        if ("..." in line):
            continue

        if(len(line.split('\t')) >= 3):
            command = line.split('\t')[2]
            instruction = command.split(" ")[0]
        else:
            continue

        i.write(instruction + '\n')

    i.close()
    instructions = open("triple_fantasy_instructions.txt", "r")
    i = instructions.read()
    texts = [word for word in i.lower().split("\n")]

    for text in texts:
        if (text == " ") or (text == ""):
            texts.remove(text)

    # print(texts)
    return texts

def languageAnalysis(i):
    frequency = defaultdict(int)
    for token in i:
        frequency[token] += 1

    processed_corpus = [token for token in i if frequency[token] > 1]

    # corpora.Dictionary() takes a list of lists as input
    j = [processed_corpus]

    dictionary = corpora.Dictionary(j)
    print(dictionary)

i = parseInstructions(objdump, instructions)

objdump.close()

languageAnalysis(i)
